---
title: "HDS Exercise set 1"
author: "Shabbeer Hassan"
output:
  pdf_document: default
  html_document: default
theme: cerulean
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
set.seed(29)
```

<style type="text/css">

body{ /* Normal  */
      font-size: 12px;
  }
td {  /* Table  */
  font-size: 8px;
}
h1.title {
  font-size: 30px;
  color: DarkRed;
}
h1 { /* Header 1 */
  font-size: 22px;
  color: DarkBlue;
}
h2 { /* Header 2 */
    font-size: 20px;
  color: DarkBlue;
}
h3 { /* Header 3 */
  font-size: 18px;
  font-family: "Times New Roman", Times, serif;
  color: DarkBlue;
}
h4 { /* Header 4 */
  font-size: 14px;
  font-family: "Times New Roman", Times, serif;
  color: Black;
}
code.r{ /* Code block */
    font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
    font-size: 14px;
}
</style>


### Problem 3 - Solution

```{r echo=T}
## Generate a set of p=100, P-values using command
pval = c(runif(80), rbeta(20, 1, 100))

## Step by step
sort_pval <- sort(pval)
manual_BH <- 0.5 * (1:length(sort_pval))/length(sort_pval)

## Use function
func_BH <- p.adjust(pval, method="BH")

## Get the combined df
pval_df <- data.frame( manual =  manual_BH, adjust = func_BH )

## Compare both
ggplot( pval_df, aes( x = func_BH, y = manual_BH  ) ) + geom_point( size = 3, color = 'blue' )  + 
        theme(panel.grid.minor = element_line(colour = "grey", size = 0.1), 
        panel.grid.major = element_line(colour = "grey", size = 0.5),
        axis.text=element_text(size=20),
        axis.title=element_text(size=20,face="bold")) +
        labs(x = "BH pvalues from p.adjust", y = 'BH pvalues manually') + theme_bw()+
        geom_abline( intercept = 0, slope = 1 ) 

```


#### 

### Problem 4 - SOlutions

(a)
```{r echo=T}
n = 1000 
p = 10000 
m = 100 
b = sqrt( 0.01 / (1 - 0.01) ) #This means each predictor explains 1%

## indicator for non-null effects 
eff = c(rep(T, m), rep(F, p-m))

Prop_adjust <- data.frame(matrix(nrow = 1000, ncol = 1))
Prop_BF <- data.frame(matrix(nrow = 1000, ncol = 1))
Prop_BH <- data.frame(matrix(nrow = 1000, ncol = 1))
pval <- data.frame(matrix(nrow = 1000, ncol = 1))
BH_pval <- data.frame(matrix(nrow = 1000, ncol = 1))

for (i in 1:1000) {    

pval[i,] = pchisq( rnorm(p, b*sqrt(n) * as.numeric(eff), 1)^2, df = 1, lower = F) 

# Non-adjusted p-values
Prop_adjust[i,] <- length(pval[i,][(pval[i,] < 0.05)])/n

# Bonferroni correction
## Get Bonferroni corrected P-value
BF_pval[i,] <- 0.05/p 
Prop_BF[i,] <- length(pval[i,][(pval[i,] < BF_pval[i,])])/n

# Benjamini and Hochberg FDR at alpha=0.05
BH_pval[i,] <- p.adjust(pval[i,], "BH")
Prop_BH[i,] <- length(pval[i,][(pval[i,] < BH_pval[i,])])/n

}


## Histograms
hist(Prop_adjust)
```

